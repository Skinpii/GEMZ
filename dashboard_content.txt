import React, { useContext, useRef, useState, useEffect } from 'react';
import { UserContextData } from '../context/userContext';
import { Link } from 'react-router-dom';
import { FaHeart, FaRegHeart } from 'react-icons/fa';
import { randomizeCardAnimations } from '../utils/animationHelper';
import { popularSites } from '../data/siteData';
import './Dashboard.css';

const Dashboard = () => {
      { name: 'Anime Nexus', url: 'https://anime.nexus', icon: 'üç•' },
      { name: 'Hi Anime', url: 'https://hianime.to', icon: 'üéå' },
      { name: '9anime TV', url: 'https://9animetv.to', icon: 'üêâ' },
      { name: 'Anitaku', url: 'https://anitaku.io', icon: 'üèØ' },
      { name: 'AnimeKai', url: 'https://animekai.to', icon: '‚õ©Ô∏è' },
      { name: 'GoGoAnime', url: 'https://gogoanime.org.vc', icon: 'üçô' },
      { name: 'AnimePahe', url: 'https://animepahe.ru', icon: 'üé≠' },
      { name: 'KickAssAnime', url: 'https://kickassanime.mx', icon: 'üëä' },
      { name: 'AniWatch TV', url: 'https://aniwatchtv.to', icon: 'üëÅÔ∏è' },
      { name: 'AnimeZ', url: 'https://animez.org', icon: 'üé¨' },
      { name: 'AnimeGG', url: 'https://animegg.org', icon: 'ü•ö' },
      { name: 'AnimeStream', url: 'https://animestream.net', icon: 'üì∫' },
      { name: 'KissAnime', url: 'https://kissanime.com.ru', icon: 'üíã' },
      { name: 'AllManga', url: 'https://allmanga.to', icon: 'üìö' },
      { name: 'AniWorld', url: 'https://aniworld.to', icon: 'üåè' },
      { name: 'WCOStream', url: 'https://wcostream.tv', icon: 'üì∫' },
      { name: 'Nyaa', url: 'https://nyaa.land', icon: 'üê±' },
      { name: '123Animes', url: 'https://123animes.ru', icon: 'üî¢' }
    ]
  },
  {
    category: 'Manga',
    sites: [
      { name: 'MangaPark', url: 'https://mangapark.io', icon: 'üìñ' },
      { name: 'MangaFire', url: 'https://mangafire.to', icon: 'üî•' },
      { name: 'Comick', url: 'https://comick.io', icon: 'üìö' },
      { name: 'Batoto', url: 'https://batotoo.com', icon: 'ü¶á' },
      { name: 'MangaDex', url: 'https://mangadex.org', icon: 'üìò' },
      { name: 'AllManga', url: 'https://allmanga.to', icon: 'üìë' },
      { name: 'Mangago', url: 'https://mangago.me', icon: 'üìù' },
      { name: 'WeebCentral', url: 'https://weebcentral.com', icon: 'üåü' }
    ]
  },
  {
    category: 'LLMs & Chatbots',
    sites: [
      { name: 'ChatGPT (OpenAI)', url: 'https://chat.openai.com', icon: 'ü§ñ' },
      { name: 'Gemini (Google)', url: 'https://gemini.google.com', icon: '‚ú®' },
      { name: 'Claude (Anthropic)', url: 'https://claude.ai', icon: 'üß†' },
      { name: 'Perplexity AI', url: 'https://www.perplexity.ai', icon: 'üîç' },
      { name: 'DeepSeek Chat', url: 'https://chat.deepseek.com', icon: 'üí¨' },
      { name: 'Mistral AI', url: 'https://mistral.ai', icon: 'üå™Ô∏è' },
      { name: 'Llama 3 (Meta)', url: 'https://llama.meta.com', icon: 'ü¶ô' },
      { name: 'Cohere', url: 'https://cohere.com', icon: 'üîÑ' }
    ]
  },
  {
    category: 'AI Image & Video Generators',
    sites: [
      { name: 'MidJourney', url: 'https://www.midjourney.com', icon: 'üé®' },
      { name: 'DALL¬∑E 3', url: 'https://openai.com/dall-e', icon: 'üñºÔ∏è' },
      { name: 'Stable Diffusion', url: 'https://stablediffusionweb.com', icon: 'üåà' },
      { name: 'Runway ML', url: 'https://runwayml.com', icon: 'üé¨' },
      { name: 'Pika Labs', url: 'https://pika.art', icon: 'üìπ' },
      { name: 'Leonardo AI', url: 'https://leonardo.ai', icon: 'üé≠' },
      { name: 'Suno AI', url: 'https://suno.com', icon: 'üéµ' }
    ]
  },
  {
    category: 'AI Coding Assistants',
    sites: [
      { name: 'GitHub Copilot', url: 'https://github.com/features/copilot', icon: 'üë®‚Äçüíª' },
      { name: 'Tabnine', url: 'https://www.tabnine.com', icon: 'üìù' },
      { name: 'Codeium', url: 'https://codeium.com', icon: 'üíª' },
      { name: 'Replit Ghostwriter', url: 'https://replit.com/ai', icon: 'üëª' },
      { name: 'Amazon CodeWhisperer', url: 'https://aws.amazon.com/codewhisperer', icon: 'üìä' }
    ]
  },
  {
    category: 'AI APIs for Developers',
    sites: [
      { name: 'OpenAI API', url: 'https://platform.openai.com', icon: 'üîå' },
      { name: 'Anthropic API', url: 'https://www.anthropic.com/api', icon: 'üß©' },
      { name: 'Hugging Face', url: 'https://huggingface.co', icon: 'ü§ó' },
      { name: 'Fireworks AI', url: 'https://fireworks.ai', icon: 'üéÜ' },
      { name: 'Groq API', url: 'https://groq.com', icon: '‚ö°' }
    ]
  },
  {
    category: 'AI Voice & Speech Tools',
    sites: [
      { name: 'ElevenLabs', url: 'https://elevenlabs.io', icon: 'üó£Ô∏è' },
      { name: 'Murf AI', url: 'https://murf.ai', icon: 'üé§' },
      { name: 'Descript', url: 'https://www.descript.com', icon: 'üéôÔ∏è' },
      { name: 'HeyGen', url: 'https://www.heygen.com', icon: 'üì±' }
    ]
  },
  {
    category: 'Free AI Tools',
    sites: [
      { name: 'DeepSeek Chat (Free)', url: 'https://chat.deepseek.com', icon: 'üí´' },
      { name: 'Ollama (Local AI)', url: 'https://ollama.ai', icon: 'üñ•Ô∏è' },
      { name: 'LM Studio', url: 'https://lmstudio.ai', icon: 'üß™' },
      { name: 'Hugging Face Chat', url: 'https://huggingface.co/chat', icon: 'üí≠' }
    ]
  },
  {
    category: 'AI Search Engines',
    sites: [
      { name: 'Perplexity AI', url: 'https://perplexity.ai', icon: 'üîé' },
      { name: 'You.com', url: 'https://you.com', icon: 'üåê' },
      { name: 'Phind', url: 'https://phind.com', icon: 'üîç' }
    ]
  },
  {
    category: 'AI for Productivity',
    sites: [
      { name: 'Notion AI', url: 'https://www.notion.so/product/ai', icon: 'üìì' },
      { name: 'Grammarly AI', url: 'https://www.grammarly.com', icon: '‚úèÔ∏è' },
      { name: 'Tome AI', url: 'https://tome.app', icon: 'üìä' }
    ]
  },
  {
    category: 'AI for Data & Analytics',
    sites: [
      { name: 'Pandas AI', url: 'https://github.com/gventuri/pandas-ai', icon: 'üêº' },
      { name: 'Tableau GPT', url: 'https://www.tableau.com', icon: 'üìà' }
    ]
  },
  {
    category: 'AI Learning & Courses',
    sites: [
      { name: 'DeepLearning.AI', url: 'https://www.deeplearning.ai', icon: 'üß†' },
      { name: 'Fast.ai', url: 'https://www.fast.ai', icon: 'üöÄ' }
    ]
  },
  {
    category: 'Social Media',
    sites: [
      { name: 'Twitter/X', url: 'https://twitter.com', icon: 'üê¶' },
      { name: 'Instagram', url: 'https://instagram.com', icon: 'üì∑' },
      { name: 'Facebook', url: 'https://facebook.com', icon: 'üë•' },
      { name: 'LinkedIn', url: 'https://linkedin.com', icon: 'üíº' },
      { name: 'Reddit', url: 'https://reddit.com', icon: 'üî¥' }
    ]
  },
  {
    category: 'Productivity',
    sites: [
      { name: 'Gmail', url: 'https://mail.google.com', icon: 'üìß' },
      { name: 'Google Drive', url: 'https://drive.google.com', icon: 'üìÅ' },
      { name: 'Notion', url: 'https://notion.so', icon: 'üìù' },
      { name: 'Trello', url: 'https://trello.com', icon: 'üìã' },
      { name: 'Slack', url: 'https://slack.com', icon: 'üí¨' }
    ]
  },
  {
    category: 'Development',
    sites: [
      { name: 'GitHub', url: 'https://github.com', icon: 'üíª' },
      { name: 'Stack Overflow', url: 'https://stackoverflow.com', icon: '‚ùì' },
      { name: 'CodePen', url: 'https://codepen.io', icon: 'üñäÔ∏è' },
      { name: 'MDN Web Docs', url: 'https://developer.mozilla.org', icon: 'üìö' },
      { name: 'VS Code', url: 'https://vscode.dev', icon: 'üìù' }
    ]
  },
  {
    category: 'Note-taking Apps (All-in-One)',
    sites: [
      { name: 'Notion', url: 'https://www.notion.so', icon: 'üìì' },
      { name: 'Coda', url: 'https://coda.io', icon: 'üìä' },
      { name: 'ClickUp', url: 'https://clickup.com', icon: '‚úÖ' }
    ]
  },
  {
    category: 'Markdown & Developer-Friendly Notes',
    sites: [
      { name: 'Obsidian', url: 'https://obsidian.md', icon: 'üîÆ' },
      { name: 'Logseq', url: 'https://logseq.com', icon: 'üß†' },
      { name: 'Typora', url: 'https://typora.io', icon: 'üìù' }
    ]
  },
  {
    category: 'Simple & Lightweight Notes',
    sites: [
      { name: 'Evernote', url: 'https://evernote.com', icon: 'üêò' },
      { name: 'Bear', url: 'https://bear.app', icon: 'üêª' },
      { name: 'Simplenote', url: 'https://simplenote.com', icon: '‚úèÔ∏è' }
    ]
  },
  {
    category: 'Open-Source & Privacy-Focused Notes',
    sites: [
      { name: 'Joplin', url: 'https://joplinapp.org', icon: 'üîí' },
      { name: 'Standard Notes', url: 'https://standardnotes.com', icon: 'üõ°Ô∏è' },
      { name: 'Zettlr', url: 'https://www.zettlr.com', icon: 'üìÑ' }
    ]
  },
  {
    category: 'Specialized Note-taking Tools',
    sites: [
      { name: 'Roam Research', url: 'https://roamresearch.com', icon: 'üîÑ' },
      { name: 'Tana', url: 'https://tana.inc', icon: 'üå±' },
      { name: 'Mem', url: 'https://mem.ai', icon: 'üß©' }
    ]
  },
  {
    category: 'Offline/Desktop Note-taking',
    sites: [
      { name: 'OneNote', url: 'https://www.onenote.com', icon: 'üìî' },
      { name: 'Apple Notes', url: 'https://www.apple.com/notes', icon: 'üçè' },
      { name: 'QOwnNotes', url: 'https://www.qownnotes.org', icon: 'üìã' }
    ]
  }
];

const Dashboard = () => {
  const { user, logout, favorites, recentlyUsed, trackSiteUsage, toggleFavorite, isFavorite } = useContext(UserContextData);
  const [activeCategory, setActiveCategory] = useState(null);
  
  // Create refs for section scrolling
  const sectionRefs = useRef({});
  
  // Initialize refs for each category
  useEffect(() => {
    // Add Favorites and Recently Used sections
    sectionRefs.current = {
      'Favorites': React.createRef(),
      'Recently Used': React.createRef(),
    };
    
    // Add refs for all website categories
    popularSites.forEach(category => {
      sectionRefs.current[category.category] = React.createRef();
    });
  }, []);  // Add animation to cards on component mount and when data changes
  useEffect(() => {
    // Initial animation with a short delay to ensure DOM is ready
    const initialTimer = setTimeout(() => {
      randomizeCardAnimations();
    }, 100);

    // Handle window focus events to re-apply animations when user returns to tab
    const handleFocus = () => {
      setTimeout(() => randomizeCardAnimations(), 100);
    };
    
    window.addEventListener('focus', handleFocus);
    
    // Cleanup
    return () => {
      clearTimeout(initialTimer);
      window.removeEventListener('focus', handleFocus);
    };
  }, [favorites, recentlyUsed]);

  const handleSiteClick = (site) => {
    // Track the site usage
    trackSiteUsage(site);
    
    // Open the site in a new tab
    window.open(site.url, '_blank');
  };
  
  // Scroll to section when clicked in sidebar
  const scrollToSection = (category) => {
    setActiveCategory(category);
    if (sectionRefs.current[category] && sectionRefs.current[category].current) {
      sectionRefs.current[category].current.scrollIntoView({
        behavior: 'smooth',
        block: 'start',
      });
    }
  };
  
  return (
    <div className="dashboard-layout">
      {/* Sidebar Navigation */}      <aside className="sidebar">
        <div className="sidebar-header">
          <h1 className="sidebar-title">Website Redirector</h1>
          <div className="user-welcome">
            <span className="username">Welcome, {user?.username}</span>
          </div>
        </div>
        
        <nav className="sidebar-nav">
          <ul className="nav-list">
            {/* Main Navigation */}
            <li className="nav-section">Navigation</li>
            <li className="nav-item">
              <Link to="/" className="nav-link">
                <span className="nav-icon">üè†</span>
                <span className="nav-label">Home</span>
              </Link>
            </li>
            <li className="nav-item active">
              <span className="nav-icon">üìä</span>
              <span className="nav-label">Dashboard</span>
            </li>
            
            {/* Add Favorites and Recently Used to Navigation */}
            <li className="nav-section">User Content</li>
            <li 
              className={`nav-item ${activeCategory === 'Favorites' ? 'active' : ''}`}
              onClick={() => scrollToSection('Favorites')}
            >
              <span className="nav-icon">‚≠ê</span>
              <span className="nav-label">Favorites</span>
            </li>
            {recentlyUsed.length > 0 && (
              <li 
                className={`nav-item ${activeCategory === 'Recently Used' ? 'active' : ''}`}
                onClick={() => scrollToSection('Recently Used')}
              >
                <span className="nav-icon">üïí</span>
                <span className="nav-label">Recently Used</span>
              </li>
            )}
            
            {/* Add Category Navigation */}
            <li className="nav-section">Categories</li>
            {popularSites.map((category) => (              <li 
                key={category.category}
                className={`nav-item ${activeCategory === category.category ? 'active' : ''}`}
              >
                <Link 
                  to={`/category/${category.category.toLowerCase().replace(/\s+/g, '-')}`}
                  className="nav-link"
                >
                  <span className="nav-icon">{category.icon || category.sites[0]?.icon || 'üìÅ'}</span>
                  <span className="nav-label">{category.category}</span>
                </Link>
              </li>
            ))}
          </ul>
        </nav>
        
        <div className="sidebar-footer">
          <button
            onClick={logout}
            className="logout-btn"
          >
            Logout
          </button>
        </div>
      </aside>

      {/* Main Content */}
      <main className="dashboard-content">      {/* Favorites Section */}
      <section className="section" ref={sectionRefs.current['Favorites']}>
        <h2 className="section-title">Favorites</h2>
        {favorites.length > 0 ? (
          <div className="sites-grid">
            {favorites.map((site, index) => (
              <div 
                key={`fav-${index}`} 
                className="site-card"
                onClick={() => handleSiteClick(site)}
              >
                <div className="site-icon">{site.icon}</div>
                <h3 className="site-name">{site.name}</h3>
                <button 
                  className="favorite-btn"
                  onClick={(e) => {
                    e.stopPropagation();
                    toggleFavorite(site);
                  }}
                >
                  <FaHeart />
                </button>
              </div>
            ))}
          </div>
        ) : (
          <p className="empty-message">No favorites yet. Click the heart icon to add sites to your favorites.</p>
        )}
      </section>      {/* Recently Used Section */}
      {recentlyUsed.length > 0 && (
        <section className="section" ref={sectionRefs.current['Recently Used']}>
          <h2 className="section-title">Recently Used</h2>
          <div className="sites-grid">
            {recentlyUsed.map((site, index) => (
              <div 
                key={`recent-${index}`} 
                className="site-card"
                onClick={() => handleSiteClick(site)}
              >
                <div className="site-icon">{site.icon}</div>
                <h3 className="site-name">{site.name}</h3>
                <button 
                  className="favorite-btn"
                  onClick={(e) => {
                    e.stopPropagation();
                    toggleFavorite(site);
                  }}
                >
                  {isFavorite(site.url) ? <FaHeart /> : <FaRegHeart />}
                </button>
              </div>
            ))}
          </div>
        </section>
      )}      {/* Popular Sites by Category */}
      {popularSites.map((category) => (
        <section 
          key={category.category} 
          className="section"
          ref={sectionRefs.current[category.category]}
          id={category.category.toLowerCase().replace(/\s+/g, '-')}
        >
          <h2 className="section-title">{category.category}</h2>
          <div className="sites-grid">
            {category.sites.map((site, index) => (
              <div 
                key={`${category.category}-${index}`} 
                className="site-card"
                onClick={() => handleSiteClick(site)}
              >
                <div className="site-icon">{site.icon}</div>
                <h3 className="site-name">{site.name}</h3>
                <button 
                  className="favorite-btn"
                  onClick={(e) => {
                    e.stopPropagation();
                    toggleFavorite(site);
                  }}
                >
                  {isFavorite(site.url) ? <FaHeart /> : <FaRegHeart />}
                </button>
              </div>
            ))}
          </div>
        </section>
      ))}
      </main>
    </div>
  );
};

export default Dashboard;
